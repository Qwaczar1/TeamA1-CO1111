<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css"> <!-- Link to external stylesheet -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <!-- Responsive viewport settings -->
    <title>Unit Test - Leaderboard</title>
</head>
<body>
    <!-- Header section -->
    <header id="header">
        <div id="headerContent">
            <div id="align">
                <div id="headerContainer1">
                    <img src="media/Banner2.png" id="greenHeaderLogo" alt="Treasure Hunt Logo">
                </div>
                <div id="headerContainer2">
                    <h4>Code Cyprus</h4>
                </div>
            </div>
            <nav id="nav">
                <ul id="navList">
                    <!-- Home button -->
                    <li class="navItem">
                        <a class="navLink" href="index.html">HOME</a>
                    </li>
                    <!-- Testing button -->
                    <li class="navItem">
                        <a href="test.html" class="navLink">TESTING</a>
                    </li>
                    <!-- Refresh button -->
                    <li class="navItem">
                        <a onclick="refresh()" class="navLink">REFRESH</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    <h2 class="scoreboardHeading">Testing Leaderboard</h2>
    <table id="testScoreboardTable">
        <tr>
            <th class="tableHeader">Rank</th>
            <th class="tableHeader">Player Name</th>
            <th class="tableHeader">Score</th>
            <th class="tableHeader">Time</th>
        </tr>
    </table>
    </body>
    <script>
        const TH_API_URL = "https://codecyprus.org/th/test-api/";
        function getTestingLeaderboard(url) {
            fetch(url, { method: "GET" })
                .then(response => response.json())
                .then(json => {
                    handleTestingLeaderboard(json);
                });
        }

        getTestingLeaderboard(TH_API_URL + "leaderboard?sorted");

        function handleTestingLeaderboard(leaderboard) {
            let options = { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            let html = "";
            let count = 1;
            let leaderboardArray = leaderboard['leaderboard'];
            for(const entry of leaderboardArray) {
                let date = new Date(entry['completionTime']);
                let formattedDate = date.toLocaleDateString("en-UK", options);
                html += "<tr>" +
                    "<td class='tableData'>" + count + "</td>" +
                    "<td class='tableData'>" + entry['player'] + "</td>" +
                    "<td class='tableData'>" + entry['score'] + " Pts" + "</td>" +
                    "<td class='tableData'>" + formattedDate + "</td>" +
                    "</tr>";
                count++;
            }
            let testScoreboardTable = document.getElementById('testScoreboardTable');
            testScoreboardTable.innerHTML += html;
        }
    </script>
    <h2 class="scoreboardHeading">Actual Leaderboard</h2>
</html>